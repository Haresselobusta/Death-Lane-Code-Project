using System.Collections;
using System.Collections.Generic;
using TMPro;
using UnityEngine;
using UnityEngine.UI;

public class DistanceTracker : MonoBehaviour
{
    public static DistanceTracker Instance;

    [Header("Text Distance")]
    public float distance; //Distance
    public TMP_Text distanceText; //Text

    private bool isCounting = true;

    private void Awake()
    {
        Instance = this;
    }

    private void Update()
    {
        if (!isCounting || GameManager.Instance.isGameOver) return; //Reset the score

        ScoreBasedDistance();
    }

    public void StopScore()
    {
        if (!isCounting) return; //

        isCounting = false;

        int finalScore = Mathf.FloorToInt(distance); // 
        if(HighScoreManager.Instance != null) //
        {
            bool isNewRecord = HighScoreManager.Instance.TrySetHighScore(finalScore);
            if (isNewRecord)
            {
                Debug.Log($"New high score: {finalScore}");
            }
        }
    }

    private void ScoreBasedDistance()
    {
        distance += GameManager.Instance.gameSpeed * Time.deltaTime; //Score Implementation
        if (distanceText != null) //Output
            distanceText.text = Mathf.FloorToInt(distance).ToString() + " m"; 
    }

    public void PauseCounting()
    {
        isCounting = false;
    }

    public void ResumeCounting()
    {
        // only resume if the game is actually running
        if (GameManager.Instance != null && !GameManager.Instance.isGameOver)
            isCounting = true;
    }

    public void StopAndReportFinal()
    {
        if (!isCounting) isCounting = false;

        int finalScore = Mathf.FloorToInt(distance);
        if (HighScoreManager.Instance != null)
        {
            bool isNewRecord = HighScoreManager.Instance.TrySetHighScore(finalScore);
            if (isNewRecord)
                Debug.Log($"New high score: {finalScore}");
        }
    }
}
